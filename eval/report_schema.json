{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "STP Governance Transaction Report",
  "description": "Schema for validating Solvency Transport Protocol (STP) transaction logs.",
  "type": "object",
  "required": ["protocol_version", "governor_id", "configuration", "transactions", "aggregate_summary"],
  "properties": {
    "protocol_version": { "type": "string", "const": "2.0-RFC" },
    "governor_id": { "type": "string", "description": "Unique identifier for the governor instance" },
    
    "configuration": {
      "type": "object",
      "required": ["bridge_tax_config", "inference_engine"],
      "properties": {
        "bridge_tax_config": {
          "type": "object",
          "required": ["drift_tolerance", "insolvency_limit", "strict_mode"],
          "properties": {
            "drift_tolerance": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
            "insolvency_limit": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
            "max_negotiation_turns": { "type": "integer", "minimum": 0 },
            "strict_mode": { "type": "boolean" }
          }
        },
        "inference_engine": {
          "type": "object",
          "properties": {
            "provider": { "type": "string" },
            "model_name": { "type": "string" }
          }
        }
      }
    },

    "transactions": {
      "type": "array",
      "items": {
        "type": "object",
        "required": [
          "transaction_id",
          "timestamp_ms",
          "final_state",
          "semantic_variance",
          "bridge_tax_paid",
          "negotiation_cycles",
          "output_payload"
        ],
        "properties": {
          "transaction_id": { "type": "string" },
          "timestamp_ms": { "type": "integer" },
          
          "final_state": { 
            "type": "string", 
            "enum": ["SOLVENT", "DRIFT_DETECTED", "INSOLVENT", "CRITICAL_HALT"] 
          },
          
          "semantic_variance": { 
            "type": "number", 
            "minimum": 0.0, 
            "maximum": 1.0,
            "description": "Cosine distance from Origin Constraint (0=Identical, 1=Orthogonal)"
          },
          
          "bridge_tax_paid": { 
            "type": "boolean",
            "description": "True if the model successfully negotiated a return to solvency."
          },
          
          "negotiation_cycles": { 
            "type": "integer", 
            "minimum": 0,
            "description": "Number of inference turns used to bridge the drift."
          },

          "telemetry": {
            "type": "object",
            "properties": {
              "latency_ms": { "type": "integer" },
              "token_count": { "type": "integer" }
            }
          },

          "output_payload": { "type": "string" }
        }
      }
    },

    "aggregate_summary": {
      "type": "object",
      "required": ["total_transactions", "solvency_rate", "average_latency_ms", "critical_failures"],
      "properties": {
        "total_transactions": { "type": "integer" },
        "solvency_rate": { "type": "number", "description": "Percentage of transactions ending in SOLVENT state" },
        "average_variance": { "type": "number" },
        "average_latency_ms": { "type": "number" },
        "critical_failures": { 
          "type": "array", 
          "items": { "type": "string" },
          "description": "List of Transaction IDs that resulted in CRITICAL_HALT"
        }
      }
    }
  }
}
